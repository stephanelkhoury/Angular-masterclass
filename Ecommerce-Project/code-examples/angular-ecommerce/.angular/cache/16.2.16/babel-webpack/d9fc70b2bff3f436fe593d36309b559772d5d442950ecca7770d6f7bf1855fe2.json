{"ast":null,"code":"import { createReducer, on } from '@ngrx/store';\nimport * as CartActions from '../actions/cart.actions';\nexport const initialState = {\n  items: [],\n  total: 0,\n  loading: false,\n  error: null\n};\nexport const reducer = createReducer(initialState,\n// Add to cart\non(CartActions.addToCart, (state, {\n  item\n}) => {\n  console.log('Cart Reducer: addToCart action received', {\n    item,\n    currentState: state\n  });\n  const existingItemIndex = state.items.findIndex(cartItem => cartItem.productId === item.productId);\n  let updatedItems;\n  if (existingItemIndex >= 0) {\n    // Item exists, update quantity\n    console.log('Cart Reducer: Item exists, updating quantity');\n    updatedItems = state.items.map((cartItem, index) => index === existingItemIndex ? {\n      ...cartItem,\n      quantity: cartItem.quantity + item.quantity\n    } : cartItem);\n  } else {\n    // New item, add to cart\n    console.log('Cart Reducer: New item, adding to cart');\n    updatedItems = [...state.items, item];\n  }\n  const newState = {\n    ...state,\n    items: updatedItems,\n    total: calculateTotal(updatedItems)\n  };\n  console.log('Cart Reducer: New state', newState);\n  return newState;\n}),\n// Remove from cart\non(CartActions.removeFromCart, (state, {\n  productId\n}) => {\n  const updatedItems = state.items.filter(item => item.productId !== productId);\n  return {\n    ...state,\n    items: updatedItems,\n    total: calculateTotal(updatedItems)\n  };\n}),\n// Update cart item quantity\non(CartActions.updateCartItemQuantity, (state, {\n  productId,\n  quantity\n}) => {\n  const updatedItems = state.items.map(item => item.productId === productId ? {\n    ...item,\n    quantity\n  } : item);\n  return {\n    ...state,\n    items: updatedItems,\n    total: calculateTotal(updatedItems)\n  };\n}),\n// Clear cart\non(CartActions.clearCart, () => initialState),\n// Load cart\non(CartActions.loadCart, state => ({\n  ...state,\n  loading: true,\n  error: null\n})),\n// Load cart success\non(CartActions.loadCartSuccess, (state, {\n  items\n}) => ({\n  ...state,\n  items,\n  total: calculateTotal(items),\n  loading: false,\n  error: null\n})),\n// Load cart failure\non(CartActions.loadCartFailure, (state, {\n  error\n}) => ({\n  ...state,\n  loading: false,\n  error: typeof error === 'string' ? error : 'Failed to load cart'\n})));\n// Helper function to calculate total\nfunction calculateTotal(items) {\n  return items.reduce((total, item) => total + item.price * item.quantity, 0);\n}","map":{"version":3,"names":["createReducer","on","CartActions","initialState","items","total","loading","error","reducer","addToCart","state","item","console","log","currentState","existingItemIndex","findIndex","cartItem","productId","updatedItems","map","index","quantity","newState","calculateTotal","removeFromCart","filter","updateCartItemQuantity","clearCart","loadCart","loadCartSuccess","loadCartFailure","reduce","price"],"sources":["/Users/stephanelkhoury/Documents/GitHub/Angular-masterclass/Ecommerce-Project/code-examples/angular-ecommerce/src/app/store/reducers/cart.reducer.ts"],"sourcesContent":["import { createReducer, on } from '@ngrx/store';\nimport { CartItem } from '../../core/models/cart-item.model';\nimport * as CartActions from '../actions/cart.actions';\n\nexport interface State {\n  items: CartItem[];\n  total: number;\n  loading: boolean;\n  error: string | null;\n}\n\nexport const initialState: State = {\n  items: [],\n  total: 0,\n  loading: false,\n  error: null\n};\n\nexport const reducer = createReducer(\n  initialState,\n  \n  // Add to cart\n  on(CartActions.addToCart, (state, { item }) => {\n    console.log('Cart Reducer: addToCart action received', { item, currentState: state });\n    const existingItemIndex = state.items.findIndex(cartItem => cartItem.productId === item.productId);\n    let updatedItems: CartItem[];\n    \n    if (existingItemIndex >= 0) {\n      // Item exists, update quantity\n      console.log('Cart Reducer: Item exists, updating quantity');\n      updatedItems = state.items.map((cartItem, index) => \n        index === existingItemIndex \n          ? { ...cartItem, quantity: cartItem.quantity + item.quantity }\n          : cartItem\n      );\n    } else {\n      // New item, add to cart\n      console.log('Cart Reducer: New item, adding to cart');\n      updatedItems = [...state.items, item];\n    }\n    \n    const newState = {\n      ...state,\n      items: updatedItems,\n      total: calculateTotal(updatedItems)\n    };\n    \n    console.log('Cart Reducer: New state', newState);\n    return newState;\n  }),\n  \n  // Remove from cart\n  on(CartActions.removeFromCart, (state, { productId }) => {\n    const updatedItems = state.items.filter(item => item.productId !== productId);\n    return {\n      ...state,\n      items: updatedItems,\n      total: calculateTotal(updatedItems)\n    };\n  }),\n  \n  // Update cart item quantity\n  on(CartActions.updateCartItemQuantity, (state, { productId, quantity }) => {\n    const updatedItems = state.items.map(item => \n      item.productId === productId ? { ...item, quantity } : item\n    );\n    return {\n      ...state,\n      items: updatedItems,\n      total: calculateTotal(updatedItems)\n    };\n  }),\n  \n  // Clear cart\n  on(CartActions.clearCart, () => initialState),\n  \n  // Load cart\n  on(CartActions.loadCart, (state) => ({\n    ...state,\n    loading: true,\n    error: null\n  })),\n  \n  // Load cart success\n  on(CartActions.loadCartSuccess, (state, { items }) => ({\n    ...state,\n    items,\n    total: calculateTotal(items),\n    loading: false,\n    error: null\n  })),\n  \n  // Load cart failure\n  on(CartActions.loadCartFailure, (state, { error }) => ({\n    ...state,\n    loading: false,\n    error: typeof error === 'string' ? error : 'Failed to load cart'\n  }))\n);\n\n// Helper function to calculate total\nfunction calculateTotal(items: CartItem[]): number {\n  return items.reduce((total, item) => total + (item.price * item.quantity), 0);\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}