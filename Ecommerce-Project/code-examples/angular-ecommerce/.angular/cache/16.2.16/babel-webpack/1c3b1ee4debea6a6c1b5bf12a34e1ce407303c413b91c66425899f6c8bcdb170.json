{"ast":null,"code":"import { throwError } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\nimport { logout } from '../../store/actions/auth.actions';\nimport { setError } from '../../store/actions/ui.actions';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"@ngrx/store\";\nimport * as i3 from \"../services/notification.service\";\nclass ErrorInterceptor {\n  constructor(router, store, notificationService) {\n    this.router = router;\n    this.store = store;\n    this.notificationService = notificationService;\n  }\n  intercept(request, next) {\n    return next.handle(request).pipe(catchError(error => {\n      let errorMessage = 'An unknown error occurred';\n      if (error.error instanceof ErrorEvent) {\n        // Client-side error\n        errorMessage = `Error: ${error.error.message}`;\n      } else {\n        // Server-side error\n        errorMessage = `Error Code: ${error.status}\\nMessage: ${error.message}`;\n        if (error.status === 401) {\n          // Unauthorized - log out user\n          this.store.dispatch(logout());\n          this.router.navigate(['/auth/login']);\n          errorMessage = 'Your session has expired. Please log in again.';\n        }\n        if (error.status === 403) {\n          this.router.navigate(['/']);\n          errorMessage = 'You do not have permission to access this resource.';\n        }\n        if (error.status === 404) {\n          errorMessage = 'The requested resource was not found.';\n        }\n        if (error.status >= 500) {\n          errorMessage = 'A server error occurred. Please try again later.';\n        }\n      }\n      // Display error notification\n      this.notificationService.showError(errorMessage);\n      // Store error in the NgRx store\n      this.store.dispatch(setError({\n        error: errorMessage\n      }));\n      return throwError(() => new Error(errorMessage));\n    }));\n  }\n  static {\n    this.ɵfac = function ErrorInterceptor_Factory(t) {\n      return new (t || ErrorInterceptor)(i0.ɵɵinject(i1.Router), i0.ɵɵinject(i2.Store), i0.ɵɵinject(i3.NotificationService));\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: ErrorInterceptor,\n      factory: ErrorInterceptor.ɵfac\n    });\n  }\n}\nexport { ErrorInterceptor };","map":{"version":3,"names":["throwError","catchError","logout","setError","ErrorInterceptor","constructor","router","store","notificationService","intercept","request","next","handle","pipe","error","errorMessage","ErrorEvent","message","status","dispatch","navigate","showError","Error","i0","ɵɵinject","i1","Router","i2","Store","i3","NotificationService","factory","ɵfac"],"sources":["/Users/stephanelkhoury/Documents/GitHub/Angular-masterclass/25-Ecommerce-Project/code-examples/angular-ecommerce/src/app/core/interceptors/error.interceptor.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport {\n  HttpRequest,\n  HttpHandler,\n  HttpEvent,\n  HttpInterceptor,\n  HttpErrorResponse\n} from '@angular/common/http';\nimport { Observable, throwError } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\nimport { Router } from '@angular/router';\nimport { Store } from '@ngrx/store';\n\nimport { AppState } from '../../store';\nimport { logout } from '../../store/actions/auth.actions';\nimport { setError } from '../../store/actions/ui.actions';\nimport { NotificationService } from '../services/notification.service';\n\n@Injectable()\nexport class ErrorInterceptor implements HttpInterceptor {\n  constructor(\n    private router: Router,\n    private store: Store<AppState>,\n    private notificationService: NotificationService\n  ) {}\n\n  intercept(request: HttpRequest<unknown>, next: HttpHandler): Observable<HttpEvent<unknown>> {\n    return next.handle(request).pipe(\n      catchError((error: HttpErrorResponse) => {\n        let errorMessage = 'An unknown error occurred';\n        \n        if (error.error instanceof ErrorEvent) {\n          // Client-side error\n          errorMessage = `Error: ${error.error.message}`;\n        } else {\n          // Server-side error\n          errorMessage = `Error Code: ${error.status}\\nMessage: ${error.message}`;\n          \n          if (error.status === 401) {\n            // Unauthorized - log out user\n            this.store.dispatch(logout());\n            this.router.navigate(['/auth/login']);\n            errorMessage = 'Your session has expired. Please log in again.';\n          }\n          \n          if (error.status === 403) {\n            this.router.navigate(['/']);\n            errorMessage = 'You do not have permission to access this resource.';\n          }\n          \n          if (error.status === 404) {\n            errorMessage = 'The requested resource was not found.';\n          }\n          \n          if (error.status >= 500) {\n            errorMessage = 'A server error occurred. Please try again later.';\n          }\n        }\n        \n        // Display error notification\n        this.notificationService.showError(errorMessage);\n        \n        // Store error in the NgRx store\n        this.store.dispatch(setError({ error: errorMessage }));\n        \n        return throwError(() => new Error(errorMessage));\n      })\n    );\n  }\n}"],"mappings":"AAQA,SAAqBA,UAAU,QAAQ,MAAM;AAC7C,SAASC,UAAU,QAAQ,gBAAgB;AAK3C,SAASC,MAAM,QAAQ,kCAAkC;AACzD,SAASC,QAAQ,QAAQ,gCAAgC;;;;;AAGzD,MACaC,gBAAgB;EAC3BC,YACUC,MAAc,EACdC,KAAsB,EACtBC,mBAAwC;IAFxC,KAAAF,MAAM,GAANA,MAAM;IACN,KAAAC,KAAK,GAALA,KAAK;IACL,KAAAC,mBAAmB,GAAnBA,mBAAmB;EAC1B;EAEHC,SAASA,CAACC,OAA6B,EAAEC,IAAiB;IACxD,OAAOA,IAAI,CAACC,MAAM,CAACF,OAAO,CAAC,CAACG,IAAI,CAC9BZ,UAAU,CAAEa,KAAwB,IAAI;MACtC,IAAIC,YAAY,GAAG,2BAA2B;MAE9C,IAAID,KAAK,CAACA,KAAK,YAAYE,UAAU,EAAE;QACrC;QACAD,YAAY,GAAG,UAAUD,KAAK,CAACA,KAAK,CAACG,OAAO,EAAE;OAC/C,MAAM;QACL;QACAF,YAAY,GAAG,eAAeD,KAAK,CAACI,MAAM,cAAcJ,KAAK,CAACG,OAAO,EAAE;QAEvE,IAAIH,KAAK,CAACI,MAAM,KAAK,GAAG,EAAE;UACxB;UACA,IAAI,CAACX,KAAK,CAACY,QAAQ,CAACjB,MAAM,EAAE,CAAC;UAC7B,IAAI,CAACI,MAAM,CAACc,QAAQ,CAAC,CAAC,aAAa,CAAC,CAAC;UACrCL,YAAY,GAAG,gDAAgD;;QAGjE,IAAID,KAAK,CAACI,MAAM,KAAK,GAAG,EAAE;UACxB,IAAI,CAACZ,MAAM,CAACc,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC;UAC3BL,YAAY,GAAG,qDAAqD;;QAGtE,IAAID,KAAK,CAACI,MAAM,KAAK,GAAG,EAAE;UACxBH,YAAY,GAAG,uCAAuC;;QAGxD,IAAID,KAAK,CAACI,MAAM,IAAI,GAAG,EAAE;UACvBH,YAAY,GAAG,kDAAkD;;;MAIrE;MACA,IAAI,CAACP,mBAAmB,CAACa,SAAS,CAACN,YAAY,CAAC;MAEhD;MACA,IAAI,CAACR,KAAK,CAACY,QAAQ,CAAChB,QAAQ,CAAC;QAAEW,KAAK,EAAEC;MAAY,CAAE,CAAC,CAAC;MAEtD,OAAOf,UAAU,CAAC,MAAM,IAAIsB,KAAK,CAACP,YAAY,CAAC,CAAC;IAClD,CAAC,CAAC,CACH;EACH;;;uBAjDWX,gBAAgB,EAAAmB,EAAA,CAAAC,QAAA,CAAAC,EAAA,CAAAC,MAAA,GAAAH,EAAA,CAAAC,QAAA,CAAAG,EAAA,CAAAC,KAAA,GAAAL,EAAA,CAAAC,QAAA,CAAAK,EAAA,CAAAC,mBAAA;IAAA;EAAA;;;aAAhB1B,gBAAgB;MAAA2B,OAAA,EAAhB3B,gBAAgB,CAAA4B;IAAA;EAAA;;SAAhB5B,gBAAgB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}