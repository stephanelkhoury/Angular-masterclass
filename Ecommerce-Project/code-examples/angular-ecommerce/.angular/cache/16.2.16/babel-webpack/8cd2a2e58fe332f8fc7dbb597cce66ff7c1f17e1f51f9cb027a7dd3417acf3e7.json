{"ast":null,"code":"import { FormControl } from '@angular/forms';\nimport { Subject, combineLatest } from 'rxjs';\nimport { takeUntil, debounceTime, map } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ngrx/store\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"../../core/services/product.service\";\nimport * as i4 from \"../../core/services/cart.service\";\nimport * as i5 from \"../../core/services/notification.service\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"@angular/forms\";\nimport * as i8 from \"@angular/material/button\";\nimport * as i9 from \"@angular/material/icon\";\nimport * as i10 from \"@angular/material/input\";\nimport * as i11 from \"@angular/material/form-field\";\nimport * as i12 from \"../../shared/components/loading-spinner/loading-spinner.component\";\nimport * as i13 from \"./components/product-filters/product-filters.component\";\nimport * as i14 from \"./components/product-sort/product-sort.component\";\nimport * as i15 from \"./components/product-grid/product-grid.component\";\nimport * as i16 from \"./components/category-menu/category-menu.component\";\nfunction ProductsComponent_app_loading_spinner_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"app-loading-spinner\", 22);\n  }\n  if (rf & 2) {\n    i0.ɵɵproperty(\"overlay\", true);\n  }\n}\nfunction ProductsComponent_button_12_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 23);\n    i0.ɵɵlistener(\"click\", function ProductsComponent_button_12_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.searchControl.setValue(\"\"));\n    });\n    i0.ɵɵelementStart(1, \"mat-icon\");\n    i0.ɵɵtext(2, \"close\");\n    i0.ɵɵelementEnd()();\n  }\n}\nlet ProductsComponent = /*#__PURE__*/(() => {\n  class ProductsComponent {\n    constructor(store, route, router, productService, cartService, notificationService) {\n      this.store = store;\n      this.route = route;\n      this.router = router;\n      this.productService = productService;\n      this.cartService = cartService;\n      this.notificationService = notificationService;\n      this.filters = {};\n      this.searchControl = new FormControl('');\n      this.viewMode = 'grid';\n      this.destroy$ = new Subject();\n      this.products$ = this.store.select(state => state.products.items);\n      this.categories$ = this.store.select(state => state.products.categories);\n      this.loading$ = this.store.select(state => state.ui.loading);\n      // Create filtered products stream\n      this.filteredProducts$ = combineLatest([this.products$, this.route.queryParams.pipe(map(params => {\n        const filters = {};\n        if (params['category']) filters.category = params['category'];\n        if (params['minPrice']) filters.minPrice = Number(params['minPrice']);\n        if (params['maxPrice']) filters.maxPrice = Number(params['maxPrice']);\n        if (params['rating']) filters.rating = Number(params['rating']);\n        if (params['sort']) filters.sort = params['sort'];\n        if (params['search']) {\n          filters.search = params['search'];\n          this.searchControl.setValue(params['search']);\n        }\n        this.filters = filters;\n        return filters;\n      }))]).pipe(map(([products, filters]) => this.filterProducts(products, filters)));\n    }\n    ngOnInit() {\n      // Load products and categories\n      this.productService.loadProducts();\n      this.productService.loadCategories();\n      // Handle search input with debounce\n      this.searchControl.valueChanges.pipe(debounceTime(300), takeUntil(this.destroy$)).subscribe(value => {\n        this.updateFilters({\n          search: value || undefined\n        });\n      });\n    }\n    ngOnDestroy() {\n      this.destroy$.next();\n      this.destroy$.complete();\n    }\n    onCategoryChange(categoryId) {\n      this.updateFilters({\n        category: categoryId || undefined\n      });\n    }\n    onPriceRangeChange(priceRange) {\n      this.updateFilters({\n        minPrice: priceRange.min,\n        maxPrice: priceRange.max\n      });\n    }\n    onRatingChange(rating) {\n      this.updateFilters({\n        rating: rating || undefined\n      });\n    }\n    onSortChange(sort) {\n      this.updateFilters({\n        sort\n      });\n    }\n    onViewModeChange(mode) {\n      this.viewMode = mode;\n    }\n    onAddToCart(product) {\n      this.cartService.addToCart(product);\n      this.notificationService.show(`${product.name} added to cart`);\n    }\n    onAddToWishlist(product) {\n      // This would dispatch the appropriate action for the wishlist\n      this.notificationService.show(`${product.name} added to wishlist`);\n    }\n    onViewDetails(product) {\n      this.router.navigate(['/products', product.id]);\n    }\n    resetFilters() {\n      this.searchControl.setValue('');\n      this.updateFilters({\n        category: undefined,\n        minPrice: undefined,\n        maxPrice: undefined,\n        rating: undefined,\n        sort: undefined,\n        search: undefined\n      });\n    }\n    updateFilters(newFilters) {\n      const updatedFilters = {\n        ...this.filters,\n        ...newFilters\n      };\n      // Remove undefined values\n      Object.keys(updatedFilters).forEach(key => {\n        if (updatedFilters[key] === undefined) {\n          delete updatedFilters[key];\n        }\n      });\n      // Navigate with new query params\n      this.router.navigate([], {\n        relativeTo: this.route,\n        queryParams: {\n          ...updatedFilters\n        },\n        queryParamsHandling: 'merge'\n      });\n    }\n    filterProducts(products, filters) {\n      if (!filters || Object.keys(filters).length === 0) {\n        return products;\n      }\n      let filtered = [...products];\n      // Filter by category\n      if (filters.category) {\n        filtered = filtered.filter(product => product.category?.id === filters.category);\n      }\n      // Filter by price range\n      if (filters.minPrice !== undefined) {\n        filtered = filtered.filter(product => product.price >= filters.minPrice);\n      }\n      if (filters.maxPrice !== undefined) {\n        filtered = filtered.filter(product => product.price <= filters.maxPrice);\n      }\n      // Filter by rating\n      if (filters.rating !== undefined) {\n        filtered = filtered.filter(product => product.rating >= filters.rating);\n      }\n      // Filter by search term\n      if (filters.search) {\n        const searchTerm = filters.search.toLowerCase();\n        filtered = filtered.filter(product => product.name.toLowerCase().includes(searchTerm) || product.description.toLowerCase().includes(searchTerm) || product.category?.name.toLowerCase().includes(searchTerm));\n      }\n      // Sort products\n      if (filters.sort) {\n        switch (filters.sort) {\n          case 'price-low':\n            filtered.sort((a, b) => a.price - b.price);\n            break;\n          case 'price-high':\n            filtered.sort((a, b) => b.price - a.price);\n            break;\n          case 'rating':\n            filtered.sort((a, b) => b.rating - a.rating);\n            break;\n          case 'newest':\n            filtered.sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\n            break;\n          case 'popularity':\n            filtered.sort((a, b) => (b.reviews?.length || 0) - (a.reviews?.length || 0));\n            break;\n        }\n      }\n      return filtered;\n    }\n    static {\n      this.ɵfac = function ProductsComponent_Factory(t) {\n        return new (t || ProductsComponent)(i0.ɵɵdirectiveInject(i1.Store), i0.ɵɵdirectiveInject(i2.ActivatedRoute), i0.ɵɵdirectiveInject(i2.Router), i0.ɵɵdirectiveInject(i3.ProductService), i0.ɵɵdirectiveInject(i4.CartService), i0.ɵɵdirectiveInject(i5.NotificationService));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: ProductsComponent,\n        selectors: [[\"app-products\"]],\n        decls: 38,\n        vars: 21,\n        consts: [[1, \"products-page\"], [3, \"overlay\", 4, \"ngIf\"], [1, \"container\"], [1, \"page-header\"], [1, \"page-title\"], [1, \"search-container\"], [\"appearance\", \"outline\", 1, \"search-field\"], [\"matInput\", \"\", \"placeholder\", \"Search by name, category or description\", 3, \"formControl\"], [\"matSuffix\", \"\", \"mat-icon-button\", \"\", \"aria-label\", \"Clear\", 3, \"click\", 4, \"ngIf\"], [\"matSuffix\", \"\"], [1, \"products-layout\"], [1, \"filters-sidebar\"], [3, \"categories\", \"selectedCategory\", \"categorySelected\"], [3, \"minPrice\", \"maxPrice\", \"rating\", \"priceRangeChanged\", \"ratingChanged\"], [1, \"reset-filters\"], [\"mat-stroked-button\", \"\", \"color\", \"primary\", 3, \"click\"], [1, \"products-content\"], [1, \"products-toolbar\"], [3, \"currentSort\", \"sortChanged\"], [1, \"view-options\"], [\"mat-icon-button\", \"\", 3, \"click\"], [3, \"products\", \"viewMode\", \"addToCart\", \"addToWishlist\", \"viewDetails\"], [3, \"overlay\"], [\"matSuffix\", \"\", \"mat-icon-button\", \"\", \"aria-label\", \"Clear\", 3, \"click\"]],\n        template: function ProductsComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0);\n            i0.ɵɵtemplate(1, ProductsComponent_app_loading_spinner_1_Template, 1, 1, \"app-loading-spinner\", 1);\n            i0.ɵɵpipe(2, \"async\");\n            i0.ɵɵelementStart(3, \"div\", 2)(4, \"div\", 3)(5, \"h1\", 4);\n            i0.ɵɵtext(6, \"Shop Products\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(7, \"div\", 5)(8, \"mat-form-field\", 6)(9, \"mat-label\");\n            i0.ɵɵtext(10, \"Search products\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(11, \"input\", 7);\n            i0.ɵɵtemplate(12, ProductsComponent_button_12_Template, 3, 0, \"button\", 8);\n            i0.ɵɵelementStart(13, \"mat-icon\", 9);\n            i0.ɵɵtext(14, \"search\");\n            i0.ɵɵelementEnd()()()();\n            i0.ɵɵelementStart(15, \"div\", 10)(16, \"aside\", 11)(17, \"app-category-menu\", 12);\n            i0.ɵɵlistener(\"categorySelected\", function ProductsComponent_Template_app_category_menu_categorySelected_17_listener($event) {\n              return ctx.onCategoryChange($event);\n            });\n            i0.ɵɵpipe(18, \"async\");\n            i0.ɵɵtext(19, \"> \");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(20, \"app-product-filters\", 13);\n            i0.ɵɵlistener(\"priceRangeChanged\", function ProductsComponent_Template_app_product_filters_priceRangeChanged_20_listener($event) {\n              return ctx.onPriceRangeChange($event);\n            })(\"ratingChanged\", function ProductsComponent_Template_app_product_filters_ratingChanged_20_listener($event) {\n              return ctx.onRatingChange($event);\n            });\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(21, \"div\", 14)(22, \"button\", 15);\n            i0.ɵɵlistener(\"click\", function ProductsComponent_Template_button_click_22_listener() {\n              return ctx.resetFilters();\n            });\n            i0.ɵɵelementStart(23, \"mat-icon\");\n            i0.ɵɵtext(24, \"refresh\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtext(25, \" Reset Filters \");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(26, \"div\", 16)(27, \"div\", 17)(28, \"app-product-sort\", 18);\n            i0.ɵɵlistener(\"sortChanged\", function ProductsComponent_Template_app_product_sort_sortChanged_28_listener($event) {\n              return ctx.onSortChange($event);\n            });\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(29, \"div\", 19)(30, \"button\", 20);\n            i0.ɵɵlistener(\"click\", function ProductsComponent_Template_button_click_30_listener() {\n              return ctx.onViewModeChange(\"grid\");\n            });\n            i0.ɵɵelementStart(31, \"mat-icon\");\n            i0.ɵɵtext(32, \"grid_view\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(33, \"button\", 20);\n            i0.ɵɵlistener(\"click\", function ProductsComponent_Template_button_click_33_listener() {\n              return ctx.onViewModeChange(\"list\");\n            });\n            i0.ɵɵelementStart(34, \"mat-icon\");\n            i0.ɵɵtext(35, \"view_list\");\n            i0.ɵɵelementEnd()()()();\n            i0.ɵɵelementStart(36, \"app-product-grid\", 21);\n            i0.ɵɵlistener(\"addToCart\", function ProductsComponent_Template_app_product_grid_addToCart_36_listener($event) {\n              return ctx.onAddToCart($event);\n            })(\"addToWishlist\", function ProductsComponent_Template_app_product_grid_addToWishlist_36_listener($event) {\n              return ctx.onAddToWishlist($event);\n            })(\"viewDetails\", function ProductsComponent_Template_app_product_grid_viewDetails_36_listener($event) {\n              return ctx.onViewDetails($event);\n            });\n            i0.ɵɵpipe(37, \"async\");\n            i0.ɵɵelementEnd()()()()();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(1);\n            i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(2, 15, ctx.loading$));\n            i0.ɵɵadvance(10);\n            i0.ɵɵproperty(\"formControl\", ctx.searchControl);\n            i0.ɵɵadvance(1);\n            i0.ɵɵproperty(\"ngIf\", ctx.searchControl.value);\n            i0.ɵɵadvance(5);\n            i0.ɵɵproperty(\"categories\", i0.ɵɵpipeBind1(18, 17, ctx.categories$))(\"selectedCategory\", ctx.filters.category);\n            i0.ɵɵadvance(3);\n            i0.ɵɵproperty(\"minPrice\", ctx.filters.minPrice || 0)(\"maxPrice\", ctx.filters.maxPrice || 1000)(\"rating\", ctx.filters.rating || 0);\n            i0.ɵɵadvance(8);\n            i0.ɵɵproperty(\"currentSort\", ctx.filters.sort || \"name\");\n            i0.ɵɵadvance(2);\n            i0.ɵɵclassProp(\"active\", ctx.viewMode === \"grid\");\n            i0.ɵɵadvance(3);\n            i0.ɵɵclassProp(\"active\", ctx.viewMode === \"list\");\n            i0.ɵɵadvance(3);\n            i0.ɵɵproperty(\"products\", i0.ɵɵpipeBind1(37, 19, ctx.filteredProducts$))(\"viewMode\", ctx.viewMode);\n          }\n        },\n        dependencies: [i6.NgIf, i7.DefaultValueAccessor, i7.NgControlStatus, i7.FormControlDirective, i8.MatButton, i8.MatIconButton, i9.MatIcon, i10.MatInput, i11.MatFormField, i11.MatLabel, i11.MatSuffix, i12.LoadingSpinnerComponent, i13.ProductFiltersComponent, i14.ProductSortComponent, i15.ProductGridComponent, i16.CategoryMenuComponent, i6.AsyncPipe],\n        styles: [\".products-page[_ngcontent-%COMP%]{padding:24px 0}.container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:0 16px}.page-header[_ngcontent-%COMP%]{margin-bottom:32px}.page-header[_ngcontent-%COMP%]   .page-title[_ngcontent-%COMP%]{font-size:32px;font-weight:600;margin-bottom:16px;color:#212121;position:relative}.page-header[_ngcontent-%COMP%]   .page-title[_ngcontent-%COMP%]:after{content:\\\"\\\";display:block;width:60px;height:3px;background-color:#3f51b5;margin-top:8px}.page-header[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]{max-width:600px}.page-header[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]   .search-field[_ngcontent-%COMP%]{width:100%;margin-bottom:-1.25em}.products-layout[_ngcontent-%COMP%]{display:grid;grid-template-columns:250px 1fr;gap:32px}.filters-sidebar[_ngcontent-%COMP%]{background-color:#fff;border-radius:8px;box-shadow:0 2px 4px #0000000d;padding:16px;height:-moz-fit-content;height:fit-content}.filters-sidebar[_ngcontent-%COMP%]   .reset-filters[_ngcontent-%COMP%]{margin-top:24px;text-align:center}.filters-sidebar[_ngcontent-%COMP%]   .reset-filters[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}.filters-sidebar[_ngcontent-%COMP%]   .reset-filters[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}.products-content[_ngcontent-%COMP%]   .products-toolbar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;background-color:#fff;border-radius:8px;box-shadow:0 2px 4px #0000000d;padding:12px 16px}.products-content[_ngcontent-%COMP%]   .products-toolbar[_ngcontent-%COMP%]   .view-options[_ngcontent-%COMP%]{display:flex;gap:8px}.products-content[_ngcontent-%COMP%]   .products-toolbar[_ngcontent-%COMP%]   .view-options[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{color:#3f51b5;background-color:#3f51b51a}@media (max-width: 992px){.products-layout[_ngcontent-%COMP%]{grid-template-columns:220px 1fr;gap:24px}}@media (max-width: 768px){.products-layout[_ngcontent-%COMP%]{grid-template-columns:1fr}.filters-sidebar[_ngcontent-%COMP%]{margin-bottom:24px;border-radius:8px;box-shadow:0 2px 4px #0000000d}.page-header[_ngcontent-%COMP%]   .page-title[_ngcontent-%COMP%]{font-size:28px}}\"]\n      });\n    }\n  }\n  return ProductsComponent;\n})();\nexport { ProductsComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}