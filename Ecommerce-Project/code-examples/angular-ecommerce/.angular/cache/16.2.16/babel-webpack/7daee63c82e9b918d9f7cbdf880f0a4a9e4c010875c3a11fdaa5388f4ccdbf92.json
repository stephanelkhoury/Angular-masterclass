{"ast":null,"code":"import { FormControl } from '@angular/forms';\nimport { Subject, combineLatest } from 'rxjs';\nimport { takeUntil, debounceTime, map } from 'rxjs/operators';\nimport * as ProductActions from '../../store/actions/product.actions';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ngrx/store\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"../../core/services/product.service\";\nimport * as i4 from \"../../core/services/cart.service\";\nimport * as i5 from \"../../core/services/notification.service\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"@angular/forms\";\nimport * as i8 from \"@angular/material/button\";\nimport * as i9 from \"@angular/material/icon\";\nimport * as i10 from \"@angular/material/input\";\nimport * as i11 from \"@angular/material/form-field\";\nimport * as i12 from \"../../shared/components/loading-spinner/loading-spinner.component\";\nimport * as i13 from \"./components/product-filters/product-filters.component\";\nimport * as i14 from \"./components/product-sort/product-sort.component\";\nimport * as i15 from \"./components/product-grid/product-grid.component\";\nimport * as i16 from \"./components/category-menu/category-menu.component\";\nfunction ProductsComponent_app_loading_spinner_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"app-loading-spinner\", 24);\n  }\n  if (rf & 2) {\n    i0.ɵɵproperty(\"overlay\", true);\n  }\n}\nfunction ProductsComponent_button_30_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 25);\n    i0.ɵɵlistener(\"click\", function ProductsComponent_button_30_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.searchControl.setValue(\"\"));\n    });\n    i0.ɵɵelementStart(1, \"mat-icon\");\n    i0.ɵɵtext(2, \"close\");\n    i0.ɵɵelementEnd()();\n  }\n}\nlet ProductsComponent = /*#__PURE__*/(() => {\n  class ProductsComponent {\n    constructor(store, route, router, productService, cartService, notificationService) {\n      this.store = store;\n      this.route = route;\n      this.router = router;\n      this.productService = productService;\n      this.cartService = cartService;\n      this.notificationService = notificationService;\n      this.filters = {};\n      this.searchControl = new FormControl('');\n      this.viewMode = 'grid';\n      this.destroy$ = new Subject();\n      this.products$ = this.store.select(state => state.products.items);\n      this.categories$ = this.store.select(state => state.products.categories);\n      this.loading$ = this.store.select(state => state.products.loading);\n      // Create filtered products stream\n      this.filteredProducts$ = combineLatest([this.products$, this.route.queryParams.pipe(map(params => {\n        const filters = {};\n        if (params['category']) filters.category = params['category'];\n        if (params['minPrice']) filters.minPrice = Number(params['minPrice']);\n        if (params['maxPrice']) filters.maxPrice = Number(params['maxPrice']);\n        if (params['rating']) filters.rating = Number(params['rating']);\n        if (params['sort']) filters.sort = params['sort'];\n        if (params['search']) {\n          filters.search = params['search'];\n          this.searchControl.setValue(params['search']);\n        }\n        this.filters = filters;\n        return filters;\n      }))]).pipe(map(([products, filters]) => this.filterProducts(products, filters)));\n    }\n    ngOnInit() {\n      console.log('ProductsComponent: ngOnInit - dispatching actions');\n      // Dispatch actions to load products and categories\n      this.store.dispatch(ProductActions.loadProducts({}));\n      this.store.dispatch(ProductActions.loadCategories());\n      // Subscribe to products for debugging\n      this.products$.subscribe(products => {\n        console.log('ProductsComponent: products updated', products);\n      });\n      // Subscribe to loading state for debugging\n      this.loading$.subscribe(loading => {\n        console.log('ProductsComponent: loading state', loading);\n      });\n      // Handle search input with debounce\n      this.searchControl.valueChanges.pipe(debounceTime(300), takeUntil(this.destroy$)).subscribe(value => {\n        this.updateFilters({\n          search: value || undefined\n        });\n      });\n    }\n    ngOnDestroy() {\n      this.destroy$.next();\n      this.destroy$.complete();\n    }\n    onCategoryChange(categoryId) {\n      this.updateFilters({\n        category: categoryId || undefined\n      });\n    }\n    onPriceRangeChange(priceRange) {\n      this.updateFilters({\n        minPrice: priceRange.min,\n        maxPrice: priceRange.max\n      });\n    }\n    onRatingChange(rating) {\n      this.updateFilters({\n        rating: rating || undefined\n      });\n    }\n    onSortChange(sort) {\n      this.updateFilters({\n        sort\n      });\n    }\n    onViewModeChange(mode) {\n      this.viewMode = mode;\n    }\n    onAddToCart(product) {\n      this.cartService.addToCart(product);\n      this.notificationService.show(`${product.name} added to cart`);\n    }\n    onAddToWishlist(product) {\n      // This would dispatch the appropriate action for the wishlist\n      this.notificationService.show(`${product.name} added to wishlist`);\n    }\n    onViewDetails(product) {\n      this.router.navigate(['/products', product.id]);\n    }\n    resetFilters() {\n      this.searchControl.setValue('');\n      this.updateFilters({\n        category: undefined,\n        minPrice: undefined,\n        maxPrice: undefined,\n        rating: undefined,\n        sort: undefined,\n        search: undefined\n      });\n    }\n    updateFilters(newFilters) {\n      const updatedFilters = {\n        ...this.filters,\n        ...newFilters\n      };\n      // Remove undefined values\n      Object.keys(updatedFilters).forEach(key => {\n        if (updatedFilters[key] === undefined) {\n          delete updatedFilters[key];\n        }\n      });\n      // Navigate with new query params\n      this.router.navigate([], {\n        relativeTo: this.route,\n        queryParams: {\n          ...updatedFilters\n        },\n        queryParamsHandling: 'merge'\n      });\n    }\n    filterProducts(products, filters) {\n      if (!filters || Object.keys(filters).length === 0) {\n        return products;\n      }\n      let filtered = [...products];\n      // Filter by category\n      if (filters.category) {\n        filtered = filtered.filter(product => product.category?.id === filters.category);\n      }\n      // Filter by price range\n      if (filters.minPrice !== undefined) {\n        filtered = filtered.filter(product => product.price >= filters.minPrice);\n      }\n      if (filters.maxPrice !== undefined) {\n        filtered = filtered.filter(product => product.price <= filters.maxPrice);\n      }\n      // Filter by rating\n      if (filters.rating !== undefined) {\n        filtered = filtered.filter(product => (product.rating || 0) >= filters.rating);\n      }\n      // Filter by search term\n      if (filters.search) {\n        const searchTerm = filters.search.toLowerCase();\n        filtered = filtered.filter(product => product.name.toLowerCase().includes(searchTerm) || product.description.toLowerCase().includes(searchTerm) || product.category?.name.toLowerCase().includes(searchTerm));\n      }\n      // Sort products\n      if (filters.sort) {\n        switch (filters.sort) {\n          case 'price-low':\n            filtered.sort((a, b) => a.price - b.price);\n            break;\n          case 'price-high':\n            filtered.sort((a, b) => b.price - a.price);\n            break;\n          case 'rating':\n            filtered.sort((a, b) => (b.rating || 0) - (a.rating || 0));\n            break;\n          case 'newest':\n            filtered.sort((a, b) => {\n              const dateA = a.createdAt ? new Date(a.createdAt).getTime() : 0;\n              const dateB = b.createdAt ? new Date(b.createdAt).getTime() : 0;\n              return dateB - dateA;\n            });\n            break;\n          case 'popularity':\n            filtered.sort((a, b) => (b.reviews?.length || 0) - (a.reviews?.length || 0));\n            break;\n        }\n      }\n      return filtered;\n    }\n    testApiCall() {\n      console.log('Manual test: Calling ProductService.getProducts directly');\n      this.productService.getProducts({}).subscribe({\n        next: response => {\n          console.log('Manual test: Direct API call successful:', response);\n        },\n        error: error => {\n          console.error('Manual test: Direct API call failed:', error);\n        }\n      });\n      console.log('Manual test: Calling ProductService.getCategories directly');\n      this.productService.getCategories().subscribe({\n        next: categories => {\n          console.log('Manual test: Direct categories call successful:', categories);\n        },\n        error: error => {\n          console.error('Manual test: Direct categories call failed:', error);\n        }\n      });\n    }\n    static {\n      this.ɵfac = function ProductsComponent_Factory(t) {\n        return new (t || ProductsComponent)(i0.ɵɵdirectiveInject(i1.Store), i0.ɵɵdirectiveInject(i2.ActivatedRoute), i0.ɵɵdirectiveInject(i2.Router), i0.ɵɵdirectiveInject(i3.ProductService), i0.ɵɵdirectiveInject(i4.CartService), i0.ɵɵdirectiveInject(i5.NotificationService));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: ProductsComponent,\n        selectors: [[\"app-products\"]],\n        decls: 56,\n        vars: 33,\n        consts: [[1, \"products-page\"], [3, \"overlay\", 4, \"ngIf\"], [1, \"container\"], [2, \"background\", \"#f0f0f0\", \"padding\", \"10px\", \"margin\", \"10px 0\", \"border-radius\", \"5px\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", 2, \"margin-top\", \"10px\", 3, \"click\"], [1, \"page-header\"], [1, \"page-title\"], [1, \"search-container\"], [\"appearance\", \"outline\", 1, \"search-field\"], [\"matInput\", \"\", \"placeholder\", \"Search by name, category or description\", 3, \"formControl\"], [\"matSuffix\", \"\", \"mat-icon-button\", \"\", \"aria-label\", \"Clear\", 3, \"click\", 4, \"ngIf\"], [\"matSuffix\", \"\"], [1, \"products-layout\"], [1, \"filters-sidebar\"], [3, \"categories\", \"selectedCategory\", \"categorySelected\"], [3, \"minPrice\", \"maxPrice\", \"rating\", \"priceRangeChanged\", \"ratingChanged\"], [1, \"reset-filters\"], [\"mat-stroked-button\", \"\", \"color\", \"primary\", 3, \"click\"], [1, \"products-content\"], [1, \"products-toolbar\"], [3, \"currentSort\", \"sortChanged\"], [1, \"view-options\"], [\"mat-icon-button\", \"\", 3, \"click\"], [3, \"products\", \"viewMode\", \"addToCart\", \"addToWishlist\", \"viewDetails\"], [3, \"overlay\"], [\"matSuffix\", \"\", \"mat-icon-button\", \"\", \"aria-label\", \"Clear\", 3, \"click\"]],\n        template: function ProductsComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0);\n            i0.ɵɵtemplate(1, ProductsComponent_app_loading_spinner_1_Template, 1, 1, \"app-loading-spinner\", 1);\n            i0.ɵɵpipe(2, \"async\");\n            i0.ɵɵelementStart(3, \"div\", 2)(4, \"div\", 3)(5, \"strong\");\n            i0.ɵɵtext(6, \"Debug Info:\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(7, \"br\");\n            i0.ɵɵtext(8);\n            i0.ɵɵpipe(9, \"async\");\n            i0.ɵɵelement(10, \"br\");\n            i0.ɵɵtext(11);\n            i0.ɵɵpipe(12, \"async\");\n            i0.ɵɵelement(13, \"br\");\n            i0.ɵɵtext(14);\n            i0.ɵɵpipe(15, \"async\");\n            i0.ɵɵelement(16, \"br\");\n            i0.ɵɵtext(17);\n            i0.ɵɵpipe(18, \"async\");\n            i0.ɵɵelement(19, \"br\");\n            i0.ɵɵelementStart(20, \"button\", 4);\n            i0.ɵɵlistener(\"click\", function ProductsComponent_Template_button_click_20_listener() {\n              return ctx.testApiCall();\n            });\n            i0.ɵɵtext(21, \" Test Direct API Call \");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(22, \"div\", 5)(23, \"h1\", 6);\n            i0.ɵɵtext(24, \"Shop Products\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(25, \"div\", 7)(26, \"mat-form-field\", 8)(27, \"mat-label\");\n            i0.ɵɵtext(28, \"Search products\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(29, \"input\", 9);\n            i0.ɵɵtemplate(30, ProductsComponent_button_30_Template, 3, 0, \"button\", 10);\n            i0.ɵɵelementStart(31, \"mat-icon\", 11);\n            i0.ɵɵtext(32, \"search\");\n            i0.ɵɵelementEnd()()()();\n            i0.ɵɵelementStart(33, \"div\", 12)(34, \"aside\", 13)(35, \"app-category-menu\", 14);\n            i0.ɵɵlistener(\"categorySelected\", function ProductsComponent_Template_app_category_menu_categorySelected_35_listener($event) {\n              return ctx.onCategoryChange($event);\n            });\n            i0.ɵɵpipe(36, \"async\");\n            i0.ɵɵtext(37, \"> \");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(38, \"app-product-filters\", 15);\n            i0.ɵɵlistener(\"priceRangeChanged\", function ProductsComponent_Template_app_product_filters_priceRangeChanged_38_listener($event) {\n              return ctx.onPriceRangeChange($event);\n            })(\"ratingChanged\", function ProductsComponent_Template_app_product_filters_ratingChanged_38_listener($event) {\n              return ctx.onRatingChange($event);\n            });\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(39, \"div\", 16)(40, \"button\", 17);\n            i0.ɵɵlistener(\"click\", function ProductsComponent_Template_button_click_40_listener() {\n              return ctx.resetFilters();\n            });\n            i0.ɵɵelementStart(41, \"mat-icon\");\n            i0.ɵɵtext(42, \"refresh\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtext(43, \" Reset Filters \");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(44, \"div\", 18)(45, \"div\", 19)(46, \"app-product-sort\", 20);\n            i0.ɵɵlistener(\"sortChanged\", function ProductsComponent_Template_app_product_sort_sortChanged_46_listener($event) {\n              return ctx.onSortChange($event);\n            });\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(47, \"div\", 21)(48, \"button\", 22);\n            i0.ɵɵlistener(\"click\", function ProductsComponent_Template_button_click_48_listener() {\n              return ctx.onViewModeChange(\"grid\");\n            });\n            i0.ɵɵelementStart(49, \"mat-icon\");\n            i0.ɵɵtext(50, \"grid_view\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(51, \"button\", 22);\n            i0.ɵɵlistener(\"click\", function ProductsComponent_Template_button_click_51_listener() {\n              return ctx.onViewModeChange(\"list\");\n            });\n            i0.ɵɵelementStart(52, \"mat-icon\");\n            i0.ɵɵtext(53, \"view_list\");\n            i0.ɵɵelementEnd()()()();\n            i0.ɵɵelementStart(54, \"app-product-grid\", 23);\n            i0.ɵɵlistener(\"addToCart\", function ProductsComponent_Template_app_product_grid_addToCart_54_listener($event) {\n              return ctx.onAddToCart($event);\n            })(\"addToWishlist\", function ProductsComponent_Template_app_product_grid_addToWishlist_54_listener($event) {\n              return ctx.onAddToWishlist($event);\n            })(\"viewDetails\", function ProductsComponent_Template_app_product_grid_viewDetails_54_listener($event) {\n              return ctx.onViewDetails($event);\n            });\n            i0.ɵɵpipe(55, \"async\");\n            i0.ɵɵelementEnd()()()()();\n          }\n          if (rf & 2) {\n            let tmp_2_0;\n            let tmp_3_0;\n            let tmp_4_0;\n            i0.ɵɵadvance(1);\n            i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(2, 19, ctx.loading$));\n            i0.ɵɵadvance(7);\n            i0.ɵɵtextInterpolate1(\" Loading: \", i0.ɵɵpipeBind1(9, 21, ctx.loading$), \"\");\n            i0.ɵɵadvance(3);\n            i0.ɵɵtextInterpolate1(\" Products count: \", ((tmp_2_0 = i0.ɵɵpipeBind1(12, 23, ctx.products$)) == null ? null : tmp_2_0.length) || 0, \"\");\n            i0.ɵɵadvance(3);\n            i0.ɵɵtextInterpolate1(\" Filtered products count: \", ((tmp_3_0 = i0.ɵɵpipeBind1(15, 25, ctx.filteredProducts$)) == null ? null : tmp_3_0.length) || 0, \"\");\n            i0.ɵɵadvance(3);\n            i0.ɵɵtextInterpolate1(\" Categories count: \", ((tmp_4_0 = i0.ɵɵpipeBind1(18, 27, ctx.categories$)) == null ? null : tmp_4_0.length) || 0, \"\");\n            i0.ɵɵadvance(12);\n            i0.ɵɵproperty(\"formControl\", ctx.searchControl);\n            i0.ɵɵadvance(1);\n            i0.ɵɵproperty(\"ngIf\", ctx.searchControl.value);\n            i0.ɵɵadvance(5);\n            i0.ɵɵproperty(\"categories\", i0.ɵɵpipeBind1(36, 29, ctx.categories$))(\"selectedCategory\", ctx.filters.category || null);\n            i0.ɵɵadvance(3);\n            i0.ɵɵproperty(\"minPrice\", ctx.filters.minPrice || 0)(\"maxPrice\", ctx.filters.maxPrice || 1000)(\"rating\", ctx.filters.rating || 0);\n            i0.ɵɵadvance(8);\n            i0.ɵɵproperty(\"currentSort\", ctx.filters.sort || \"name\");\n            i0.ɵɵadvance(2);\n            i0.ɵɵclassProp(\"active\", ctx.viewMode === \"grid\");\n            i0.ɵɵadvance(3);\n            i0.ɵɵclassProp(\"active\", ctx.viewMode === \"list\");\n            i0.ɵɵadvance(3);\n            i0.ɵɵproperty(\"products\", i0.ɵɵpipeBind1(55, 31, ctx.filteredProducts$))(\"viewMode\", ctx.viewMode);\n          }\n        },\n        dependencies: [i6.NgIf, i7.DefaultValueAccessor, i7.NgControlStatus, i7.FormControlDirective, i8.MatButton, i8.MatIconButton, i9.MatIcon, i10.MatInput, i11.MatFormField, i11.MatLabel, i11.MatSuffix, i12.LoadingSpinnerComponent, i13.ProductFiltersComponent, i14.ProductSortComponent, i15.ProductGridComponent, i16.CategoryMenuComponent, i6.AsyncPipe],\n        styles: [\".products-container[_ngcontent-%COMP%]{padding:var(--spacing-lg) 0;min-height:80vh}.products-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--spacing-xl);flex-wrap:wrap;gap:var(--spacing-md)}.products-title[_ngcontent-%COMP%]{font-size:2.5rem;font-weight:700;color:var(--text-primary);margin:0}.products-controls[_ngcontent-%COMP%]{display:flex;gap:var(--spacing-md);align-items:center;flex-wrap:wrap}.filter-controls[_ngcontent-%COMP%]{display:flex;gap:var(--spacing-sm);align-items:center}.sort-select[_ngcontent-%COMP%]{min-width:200px}.view-toggle[_ngcontent-%COMP%]{display:flex;border:1px solid var(--border-color);border-radius:var(--radius-md);overflow:hidden}.view-toggle[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:var(--spacing-sm) var(--spacing-md);border:none;background:var(--bg-primary);color:var(--text-secondary);cursor:pointer;transition:all var(--transition-fast)}.view-toggle[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background:var(--primary-color);color:#fff}.view-toggle[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover:not(.active){background:var(--bg-secondary)}.products-content[_ngcontent-%COMP%]{display:grid;gap:var(--spacing-xl);grid-template-columns:250px 1fr}@media (max-width: 992px){.products-content[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:var(--spacing-lg)}}.filters-sidebar[_ngcontent-%COMP%]{background:var(--bg-primary);border-radius:var(--radius-lg);padding:var(--spacing-lg);height:-moz-fit-content;height:fit-content;box-shadow:var(--shadow-sm)}@media (max-width: 992px){.filters-sidebar[_ngcontent-%COMP%]{order:2}}@media (max-width: 992px){.products-main[_ngcontent-%COMP%]{order:1}}.products-grid[_ngcontent-%COMP%]{display:grid;gap:var(--spacing-lg)}.products-grid.grid-view[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fill,minmax(280px,1fr))}.products-grid.list-view[_ngcontent-%COMP%]{grid-template-columns:1fr}@media (max-width: 768px){.products-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:var(--spacing-md)}}@media (max-width: 480px){.products-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}.no-products[_ngcontent-%COMP%]{text-align:center;padding:var(--spacing-2xl)}.no-products[_ngcontent-%COMP%]   .no-products-icon[_ngcontent-%COMP%]{font-size:4rem;color:var(--text-muted);margin-bottom:var(--spacing-lg)}.no-products[_ngcontent-%COMP%]   .no-products-title[_ngcontent-%COMP%]{font-size:1.5rem;color:var(--text-primary);margin-bottom:var(--spacing-md)}.no-products[_ngcontent-%COMP%]   .no-products-description[_ngcontent-%COMP%]{color:var(--text-secondary);margin-bottom:var(--spacing-lg)}.pagination-container[_ngcontent-%COMP%]{display:flex;justify-content:center;margin-top:var(--spacing-xl)}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:400px}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}\"]\n      });\n    }\n  }\n  return ProductsComponent;\n})();\nexport { ProductsComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}