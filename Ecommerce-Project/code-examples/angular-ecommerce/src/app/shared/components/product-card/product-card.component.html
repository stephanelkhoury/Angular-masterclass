<div class="product-card" 
     [class.out-of-stock]="product.stockQuantity === 0"
     [class.featured]="product.featured"
     [class.new-arrival]="isNewArrival"
     [class.best-seller]="isBestSeller">
     
  <!-- Product Badges -->
  <div class="product-badges">
    <div class="badge discount-badge" *ngIf="discountPercentage > 0">
      <mat-icon>local_offer</mat-icon>
      <span>{{discountPercentage}}% OFF</span>
    </div>
    <div class="badge new-badge" *ngIf="isNewArrival">
      <mat-icon>fiber_new</mat-icon>
      <span>NEW</span>
    </div>
    <div class="badge bestseller-badge" *ngIf="isBestSeller">
      <mat-icon>star</mat-icon>
      <span>BESTSELLER</span>
    </div>
    <div class="badge featured-badge" *ngIf="product.featured">
      <mat-icon>verified</mat-icon>
      <span>FEATURED</span>
    </div>
    <div class="badge sold-out-badge" *ngIf="product.stockQuantity === 0">
      <mat-icon>block</mat-icon>
      <span>SOLD OUT</span>
    </div>
    <div class="badge low-stock-badge" *ngIf="isLowStock">
      <mat-icon>warning</mat-icon>
      <span>LOW STOCK</span>
    </div>
  </div>

  <!-- Quick Action Buttons -->
  <div class="quick-actions">
    <button mat-mini-fab
            class="quick-action-btn wishlist-btn"
            [class.active]="isInWishlist"
            (click)="onToggleWishlist($event)"
            [attr.aria-label]="isInWishlist ? 'Remove from wishlist' : 'Add to wishlist'"
            matTooltip="{{isInWishlist ? 'Remove from wishlist' : 'Add to wishlist'}}">
      <mat-icon>{{isInWishlist ? 'favorite' : 'favorite_border'}}</mat-icon>
    </button>
    
    <button mat-mini-fab
            class="quick-action-btn compare-btn"
            [class.active]="isInCompare"
            (click)="onToggleCompare($event)"
            [attr.aria-label]="isInCompare ? 'Remove from compare' : 'Add to compare'"
            matTooltip="{{isInCompare ? 'Remove from compare' : 'Add to compare'}}">
      <mat-icon>{{isInCompare ? 'compare_arrows' : 'compare_arrows'}}</mat-icon>
    </button>
    
    <button mat-mini-fab
            class="quick-action-btn quick-view-btn"
            (click)="onQuickView($event)"
            aria-label="Quick view"
            matTooltip="Quick view">
      <mat-icon>visibility</mat-icon>
    </button>
  </div>
  
  <!-- Product Image Container -->
  <div class="product-image-container" (click)="onViewDetails()">
    <div class="image-overlay"></div>
    <img [src]="product.imageUrl" 
         [alt]="product.name" 
         class="product-image" 
         [loading]="loading"
         (load)="onImageLoad()"
         (error)="onImageError()">
    
    <!-- Multiple images indicator -->
    <div class="image-indicators" *ngIf="product.images && product.images.length > 1">
      <span class="indicator" 
            *ngFor="let image of product.images; let i = index"
            [class.active]="i === currentImageIndex"
            (click)="changeImage(i, $event)"></span>
    </div>
    
    <!-- Stock level indicator -->
    <div class="stock-indicator" *ngIf="product.stockQuantity > 0 && product.stockQuantity <= 10">
      <div class="stock-bar">
        <div class="stock-fill" [style.width.%]="(product.stockQuantity / 10) * 100"></div>
      </div>
      <span class="stock-text">Only {{product.stockQuantity}} left</span>
    </div>
  </div>
  
  <!-- Product Content -->
  <div class="product-content">
    <!-- Category and Brand -->
    <div class="product-meta">
      <span class="product-category">{{product.category.name}}</span>
      <span class="product-brand" *ngIf="product.brand">{{product.brand}}</span>
    </div>
    
    <!-- Product Name -->
    <h3 class="product-name" 
        (click)="onViewDetails()"
        [attr.aria-label]="product.name">
      {{product.name}}
    </h3>
    
    <!-- Rating and Reviews -->
    <div class="product-rating">
      <app-star-rating 
        [rating]="product.rating" 
        [reviewCount]="product.reviews?.length || 0"
        [size]="'small'"
        [showCount]="true">
      </app-star-rating>
    </div>
    
    <!-- Price Section -->
    <div class="product-price">
      <div class="price-main">
        <span class="current-price">{{product.price | currency}}</span>
        <span class="regular-price" *ngIf="product.regularPrice && product.regularPrice > product.price">
          {{product.regularPrice | currency}}
        </span>
      </div>
      <div class="price-details" *ngIf="showPriceDetails">
        <span class="savings" *ngIf="discountAmount > 0">
          Save {{discountAmount | currency}}
        </span>
        <span class="price-per-unit" *ngIf="product.unit && product.unitQuantity">
          {{(product.price / product.unitQuantity!) | currency}}/{{product.unit}}
        </span>
      </div>
    </div>
    
    <!-- Product Features -->
    <div class="product-features" *ngIf="product.keyFeatures && product.keyFeatures.length > 0">
      <span class="feature" *ngFor="let feature of product.keyFeatures.slice(0, 2)">
        <mat-icon class="feature-icon">check_circle</mat-icon>
        {{feature}}
      </span>
    </div>
    
    <!-- Shipping Info -->
    <div class="shipping-info" *ngIf="showShippingInfo">
      <div class="shipping-item" *ngIf="product.freeShipping">
        <mat-icon>local_shipping</mat-icon>
        <span>Free Shipping</span>
      </div>
      <div class="shipping-item" *ngIf="product.fastDelivery">
        <mat-icon>flash_on</mat-icon>
        <span>Fast Delivery</span>
      </div>
    </div>
  </div>
  
  <!-- Action Buttons -->
  <div class="product-actions" *ngIf="showActions">
    <button class="add-to-cart-btn"
            [class.loading]="addingToCart"
            (click)="onAddToCart()"
            [disabled]="product.stockQuantity === 0 || addingToCart"
            [attr.aria-label]="'Add ' + product.name + ' to cart'">
      <mat-icon *ngIf="!addingToCart">shopping_cart</mat-icon>
      <mat-spinner *ngIf="addingToCart" diameter="20"></mat-spinner>
      <span>{{addingToCart ? 'Adding...' : 'Add to Cart'}}</span>
    </button>
    
    <div class="quantity-controls" *ngIf="showQuantitySelector && product.stockQuantity > 0">
      <app-quantity-selector
        [value]="selectedQuantity"
        [max]="product.stockQuantity"
        [min]="1"
        (valueChange)="onQuantityChange($event)">
      </app-quantity-selector>
    </div>
    
    <button class="buy-now-btn"
            *ngIf="showBuyNow"
            (click)="onBuyNow()"
            [disabled]="product.stockQuantity === 0"
            [attr.aria-label]="'Buy ' + product.name + ' now'">
      <mat-icon>flash_on</mat-icon>
      <span>Buy Now</span>
    </button>
  </div>
  
  <!-- Loading Overlay -->
  <div class="loading-overlay" *ngIf="loading">
    <mat-spinner diameter="40"></mat-spinner>
  </div>
</div>
